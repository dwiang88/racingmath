<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src='lib/quintus.js'></script>
        <script src='lib/quintus_sprites.js'></script>
        <script src='lib/quintus_scenes.js'></script>
        <script src='lib/quintus_input.js'></script>
        <script src='lib/quintus_anim.js'></script>
        <script src='lib/quintus_2d.js'></script>
        <script src='lib/quintus_touch.js'></script>
        <script src='lib/quintus_ui.js'></script>
    </head>
    <body>
        <script>
        var Q = Quintus()
            .include("Sprites, Scenes, Input, 2D, Touch, UI")
            .setup({
                width: 320,
                height: 480
            })
            .controls().touch()
        
        //values for collision detection
        var SPRITE_NONE = 0;
        var SPRITE_RACER = 1;
        var SPRITE_OTHER = 2; 
        
        Q.Sprite.extend("Player",{
            init: function(p) {
              this._super(p, {
                  sheet: "player", 
                  x: 160, 
                  y: 112,
                  type: SPRITE_RACER,
                  collisionMask: SPRITE_OTHER
              });
              this.add('2d, platformerControls');

              this.on("hit.sprite",function(collision) {
                  if(collision.obj.isA("Girl")) {
                    Q.stageScene("endGame",1, { label: "You Won!" }); 
                    this.destroy();
                  }
              });
            },
        });

        Q.Sprite.extend("Girl", {
            init: function(p) {
              this._super(p, { 
                  sheet: 'girl',
                  type: SPRITE_OTHER,
                  collisionMask: SPRITE_OTHER
              });
              this.add('2d');
            }
        });
        
        Q.MovingSprite.extend("Rival", {
            init: function(p) {
              this._super(p, {
                  type: SPRITE_RACER,
                  collisionMask: SPRITE_OTHER
              });
              this.add('2d');
            },
        });

        Q.scene("level1",function(stage) {
          stage.collisionLayer(new Q.TileLayer({ dataAsset: 'level_collision.json', sheet: 'tiles', type: SPRITE_OTHER }));
          stage.insert(new Q.TileLayer({ dataAsset: 'level_background.json', sheet: 'tiles', type: SPRITE_NONE }));
          
          //rivals
          stage.insert(new Q.Rival({ x: 50, y: 112, sheet:'bluerival', vx: 100*Math.random()}));
          stage.insert(new Q.Rival({ x: 60, y: 112, sheet:'purplerival', vx: 100*Math.random() }));
          stage.insert(new Q.Rival({ x: 55, y: 112, sheet:'greenrival', vx: 100*Math.random() }));
          
          //girl
          var girl = new Q.Girl({ x: 355, y: 112, sheet:'girl'});
          stage.insert(girl);
          
          //player
          var player = stage.insert(new Q.Player());
          stage.add("viewport").follow(player);
          
          
        });
        
        //answer button
        Q.UI.AnswButton = Q.UI.Button.extend('UI.AnswButton', {
            init: function(p) {
                this._super(Q._defaults(p, {
                    fill: "#FFFFFF",
                    border: 2,
                    shadow: 3,
                    shadowColor: "rgba(0,0,0,0.5)",
                }),                     
                function() {
                    this.p.label = "Pressed";
                }
                );
            }
        });
        
        
        Q.scene("calculations",function(stage) {
            
            //current question
            
            
            //buttons
            var i;
            for(i=1;i<10;i++) {
                (function(i) {
                    stage.insert(
                        new Q.UI.AnswButton({
                            label: i+'',
                            y: 250+Math.ceil(i/3)*50,
                            x: 30+parseInt((i+2)%3)*50,                            
                            }
                        )
                    );
                })(i);
                stage.insert(new Q.UI.AnswButton({
                            label: '0',
                            y: 250+4*50,
                            x: 30+1*50,                           
                            }
                        ));
            }
            
          
          
        });

        Q.scene('endGame',function(stage) {
          var box = stage.insert(new Q.UI.Container({
            x: Q.width/2, y: Q.height/2, fill: "rgba(0,0,0,0.5)"
          }));

          var button = box.insert(new Q.UI.Button({ x: 0, y: 0, fill: "#CCCCCC",
                                                   label: "Play Again" }))         
          var label = box.insert(new Q.UI.Text({x:10, y: -10 - button.p.h, 
                                                label: stage.options.label }));
          button.on("click",function() {
            window.location.reload();
          });
          box.fit(20);
        });

        Q.load("sprites.png, sprites.json, level_collision.json, level_background.json, tiles.png", function() {
          Q.sheet("tiles","tiles.png", { tilew: 32, tileh: 32 });
          Q.compileSheets("sprites.png","sprites.json");
          Q.stageScene("level1");
          Q.stageScene("calculations",1);
        });
        </script>
    </body>
</html>
